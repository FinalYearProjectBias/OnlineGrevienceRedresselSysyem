<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="stylesAdmin.css">
</head>

<body>

    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Admin Panel</h2>
            <a data-target="add-grievance-member"><i class="fas fa-user-plus"></i>Add Grievance Cell Member</a>

            <!-- Pending Approvals Dropdown -->
            <div class="dropdown" id="pending-approvals-link">
                <span><i class="fas fa-clock"></i> Pending Approvals</span>
            </div>

            <!-- Approved Users Dropdown -->
            <div class="dropdown" id="approved-users-link">
                <span><i class="fas fa-check-circle"></i> Approved Users</span>
            </div>

            <a data-target="edit-user-profile"><i class="fas fa-user-edit"></i> Edit User Profile</a>
            <a data-target="change-password"><i class="fas fa-lock"></i> Change Password</a>
            <a data-target="grievances"><i class="fas fa-exclamation-triangle"></i> Grievances</a>
            <a data-target="reports"><i class="fas fa-file-alt"></i> Reports</a>
            <a data-target="all-grievance-members"><i class="fas fa-users"></i> All Grievance Members</a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h2>Admin Dashboard</h2>

            <!-- Welcome Admin Message -->
            <div id="welcome-message" style="color: green; text-align: center; margin-bottom: 20px;">
                Welcome, Admin! Hereâ€™s an overview of your system.
            </div>

            <!-- Sign Out Button -->
            <button class="sign-out-btn" id="sign-out-btn">Sign Out</button>

            <!-- Approved Users Section -->
            <div id="approved-users-section" class="content-section" style="display: none;">
                <h2>Approved Users</h2>
                <table id="approved-users-table" border="1">
                    <thead>
                        <tr>
                            <th>User Type</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Contact Number</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="approvedUsersTableBody">
                        <!-- Approved users will be dynamically populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Pending Approval Users Section -->
            <div id="pending-approval-section" class="content-section" style="display: none;">
                <h2>Pending Approval Users</h2>
                <table id="pending-approval-table" border="1">
                    <thead>
                        <tr>
                            <th>User type</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Contact Number</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="pendingApprovalTableBody">
                        <!-- Pending users will be dynamically populated here -->
                    </tbody>
                </table>
            </div>

            <script>
                // Function to fetch approved users
                async function fetchApprovedUsers() {
                    try {
                        const response = await fetch("https://backend-server-ohpm.onrender.com/api/v1/get_approved_users");
                        const responseJson = await response.json();
                        const approvedUsers=responseJson[0].concat(responseJson[1]).concat(responseJson[2])
                        displayUsers(approvedUsers, 'approvedUsersTableBody', 'approved');
                    } catch (error) {
                        console.error('Error fetching approved users:', error);
                    }
                }

                // Function to fetch pending approval users
                async function fetchPendingApprovalUsers() {
                    try {
                        
                        const response = await fetch("https://backend-server-ohpm.onrender.com/api/v1/admin/get_pending_approval_users");
                        const responseJson = await response.json();
                        const pendingUsers=responseJson[0].concat(responseJson[1]).concat(responseJson[2])
                        console.log(pendingUsers)
                        displayUsers(pendingUsers, 'pendingApprovalTableBody', 'pending');
                    } catch (error) {
                        console.error('Error fetching pending approval users:', error);
                    }
                }

                // Function to display users in the appropriate table
                function displayUsers(users, tableBodyId, actionType) {
                    const tableBody = document.getElementById(tableBodyId);
                    tableBody.innerHTML = ''; // Clear previous data

                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.user_type}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.contact_number}</td>
                            <td><button onclick="handleAction('${user.user_id}','${user.user_type}', '${actionType}')">${actionType === 'approved' ? 'Remove' : 'Approve'}</button></td>`;
                        tableBody.appendChild(row);
                    });
                }

                // Function to handle action (approve or remove)
                async function handleAction(userId, userType,actionType) {
                    try {
                        
                        const choice=actionType==='approved'?false:true
                        approval_data={
                            user_id:userId,
                            user_type:userType,
                            approved:choice
                        }
                        console.log(approval_data)
                        
                        const url =`https://backend-server-ohpm.onrender.com/api/v1/admin/approve_user/`;
                        const response = await fetch(url, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(approval_data)
                        });
                        const result = await response.json();
                        alert(result.message);

                        // Re-fetch data
                        fetchApprovedUsers();
                        fetchPendingApprovalUsers();
                    } catch (error) {
                        console.error(`Error performing ${actionType} action:`, error);
                    }
                }

                // Fetch users on page load
                document.addEventListener('DOMContentLoaded', () => {
                    fetchApprovedUsers();
                    fetchPendingApprovalUsers();
                });

                // Sidebar links functionality to show/hide content sections
                const approvedUsersLink = document.getElementById('approved-users-link');
                const pendingApprovalsLink = document.getElementById('pending-approvals-link');
                const approvedUsersSection = document.getElementById('approved-users-section');
                const pendingApprovalSection = document.getElementById('pending-approval-section');

                approvedUsersLink.addEventListener('click', () => {
                    approvedUsersSection.style.display = 'block';
                    pendingApprovalSection.style.display = 'none';
                });

                pendingApprovalsLink.addEventListener('click', () => {
                    approvedUsersSection.style.display = 'none';
                    pendingApprovalSection.style.display = 'block';
                });
            </script>
        </div>
    </div>
</body>

</html>
